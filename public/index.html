<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Doorbell Camera</title>
  <style>
    body {
      background-color: #fffbe6;
      color: #555300;
      font-family: monospace;
      text-align: center;
      padding-top: 50px;
    }

    .container {
      display: inline-block;
      background: #fffff5;
      border: 1px solid #ccc;
      box-shadow: 2px 2px 8px rgba(0,0,0,0.1);
      padding: 30px;
      border-radius: 6px;
      min-width: 350px;
    }

    h1 {
      margin-top: 0;
      border-bottom: 1px solid #ccc;
      padding-bottom: 10px;
    }

    input[type="file"] {
      display: block;
      margin: 15px auto;
      font-size: 14px;
    }

    button {
      background-color: #fff3a6;
      border: 1px solid #999400;
      padding: 6px 16px;
      font-family: monospace;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background-color: #fff79c;
    }

    .status {
      margin-top: 10px;
      font-size: 14px;
      color: #666;
    }

    .gallery {
      margin-top: 25px;
      text-align: center;
    }

    .gallery img {
      max-width: 150px;
      max-height: 150px;
      margin: 6px;
      border: 1px solid #bbb;
      border-radius: 3px;
    }

    footer {
      margin-top: 30px;
      font-size: 12px;
      color: #777;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üì∏ Doorbell Camera</h1>
    <form id="uploadForm">
      <input type="file" id="imageInput" accept="image/*" />
      <button type="submit">UPLOAD</button>
    </form>
    <div class="status" id="status">Status: Idle</div>

    <div class="gallery" id="gallery"></div>
  </div>

  <footer>
    Doorbell Project ‚Ä¢ 2025
  </footer>

  <script>
    const backendURL = "https://doorbell-backend.onrender.com"; // <-- your backend URL
    const uploadForm = document.getElementById("uploadForm");
    const imageInput = document.getElementById("imageInput");
    const statusDiv = document.getElementById("status");
    const gallery = document.getElementById("gallery");

    // Fetch and render images
    async function loadImages() {
      try {
        const res = await fetch(`${backendURL}/images`);
        const images = await res.json();
        gallery.innerHTML = "";
        if (images.length === 0) {
          gallery.innerHTML = "<p>No images yet.</p>";
          return;
        }
        images.forEach(img => {
          const el = document.createElement("img");
          el.src = backendURL + img.path;
          gallery.appendChild(el);
        });
      } catch (err) {
        console.error("Failed to load images:", err);
        gallery.innerHTML = "<p style='color:red;'>Failed to load images</p>";
      }
    }

    // Upload new image
    uploadForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const file = imageInput.files[0];
      if (!file) {
        alert("Please select an image first!");
        return;
      }
      const formData = new FormData();
      formData.append("image", file);

      statusDiv.textContent = "Uploading...";
      try {
        const res = await fetch(`${backendURL}/upload`, { method: "POST", body: formData });
        const data = await res.json();

        if (data.success) {
          statusDiv.textContent = "‚úÖ Upload successful!";
          loadImages();
        } else {
          statusDiv.textContent = "‚ùå Upload failed!";
        }
      } catch (err) {
        statusDiv.textContent = "‚ùå Network error!";
      }
    });

    // Initial load and auto-refresh every 10 seconds
    loadImages();
    setInterval(loadImages, 10000);
  </script>
</body>
</html>

